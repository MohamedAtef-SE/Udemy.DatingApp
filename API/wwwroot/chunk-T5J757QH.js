import{a as i,b as l,c as p,d as b,e as g}from"./chunk-L3R4MWKK.js";import{J as u,Jb as d,M as h,va as a}from"./chunk-R4PBEABJ.js";import{f as r}from"./chunk-5WK33CEB.js";var w=(()=>{class s{constructor(e){this._HttpClient=e,this.paginatedResult=a(null),this.MessageThread=a([])}createHubConnection(e,t){this._HubConnection=new g().withUrl(`${i.hubsURL}/message?user=${t}`,{accessTokenFactory:()=>e.token}).withAutomaticReconnect().build(),this._HubConnection.start().catch(n=>console.log(n)),this._HubConnection.on("ReceiveMessageThread",n=>{this.MessageThread.set(n)}),this._HubConnection.on("NewMessage",n=>{this.MessageThread.update(o=>[...o,n])}),this._HubConnection.on("UpdatedGroup",n=>{n.connections.some(o=>o.username===t)&&this.MessageThread.update(o=>(o.forEach(c=>{c.dateRead||(c.dateRead=new Date(Date.now()))}),o))})}stopHubConnection(){this._HubConnection?.state===b.Connected&&(this._HubConnection.stop().catch(e=>console.log(e)),console.log("connection stopped successfully."))}getMessage(e){let t=p(e);return e.container&&(t=t.append("Container",e.container)),this._HttpClient.get(`${i.baseURL}/messages`,{observe:"response",params:t}).subscribe({next:n=>l(n,this.paginatedResult)})}sendMessage(e,t){return r(this,null,function*(){return console.log(this._HubConnection?.state),this._HubConnection?.invoke("SendMessage",{recipientUserName:e,content:t})})}deleteMessage(e){return this._HttpClient.delete(`${i.baseURL}/messages/${e}`)}static{this.\u0275fac=function(t){return new(t||s)(h(d))}}static{this.\u0275prov=u({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();export{w as a};
